{% extends 'base.html.twig' %}

{% block title %}Partition{% endblock %}

{% block body %}
    <div class="container py-4">
        <h1 class="mb-4">Partition</h1>

        <div class="row gx-4 align-items-stretch"> {# gx-4 = écart horizontal entre colonnes #}
            <div class="col-md-6 d-flex flex-column">
                <label for="message" class="form-label">Édition</label>
                <textarea class="form-control flex-grow-1" id="message" rows="25" placeholder="Écrivez ici..." style="font-family: monospace;"></textarea>
            </div>

            <div class="col-md-6 d-flex flex-column">
                <label class="form-label">Rendu</label>
                <div id="rendered" class="form-control flex-grow-1" style="height: 100%; font-family: monospace; white-space: pre-wrap; overflow-y: auto;"></div>
            </div>

        </div>
    </div>
    {% block script %}
        <style>
            .chord {
                color: blue;
                font-weight: bold;
            }
        </style>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const input = document.getElementById('message');
                const output = document.getElementById('rendered');

                function renderChordPro(text) {
                    const lines = text.split('\n');
                    const renderedLines = lines.map(line => {
                        let chordLine = '';
                        let lyricLine = '';
                        let i = 0;

                        while (i < line.length) {
                            if (line[i] === '[') {
                                const end = line.indexOf(']', i);
                                if (end !== -1) {
                                    const chord = line.slice(i + 1, end);
                                    // L'accord doit se placer au-dessus du caractère suivant
                                    const chordPos = lyricLine.length;
                                    // Ajouter des espaces jusqu'à la bonne position
                                    while (chordLine.length < chordPos) {
                                        chordLine += ' ';
                                    }
                                    chordLine += chord;
                                    i = end + 1;
                                } else {
                                    lyricLine += line[i];
                                    i++;
                                }
                            } else {
                                lyricLine += line[i];
                                // Ajouter un espace pour l'accord s'il y en a un
                                if (chordLine.length < lyricLine.length) {
                                    chordLine += ' ';
                                }
                                i++;
                            }
                        }

                        return chordLine + '\n' + lyricLine;
                    });

                    return renderedLines.join('\n\n');
                }


                input.addEventListener('input', () => {
                    output.innerText = renderChordPro(input.value);
                });
            });
        </script>
    {% endblock %}

{% endblock %}



